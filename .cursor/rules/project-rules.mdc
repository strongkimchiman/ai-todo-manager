# AI 할 일 관리 앱 서비스 개발 규칙 (Project Rules)

## 0. 목적
프로젝트 전반에서 일관된 품질의 코드 생성 및 수정 유도.

사용자 경험(UX) 최우선, 안정적인 에러 핸들링, 보안 및 유지보수성 극대화.

## 1. 프로젝트 특성 및 기술 스택
- Framework: Next.js 15 (App Router)
- Language: TypeScript (Strict Mode)
- Styling: Tailwind CSS + shadcn/ui
- Backend/Auth: Supabase (Auth, Database, RLS 필수)
- AI: AI SDK (Vercel) + Gemini 모델
- Validation: Zod (Form 및 API 데이터 검증 필수)

## 2. 아키텍처 및 디렉터리 규칙
- 서버 우선(Server-first): 모든 로직은 서버 컴포넌트, 서버 액션에서 우선 처리. 클라이언트 컴포넌트는 최소화.

### 디렉터리 구조
- `app/`: 라우팅, 레이아웃, 서버 액션 엔트리.
- `components/ui/`: shadcn/ui 등 범용 프리젠테이션 컴포넌트.
- `features/`: 도메인 단위(tasks, habits 등)로 구성. 해당 기능 전용 컴포넌트는 `features/[name]/components/`에 위치.
- `lib/`: SDK 클라이언트(Supabase, AI), 공용 유틸(cn()), 상수.
- `hooks/`: 재사용 가능한 커스텀 훅.

## 3. Next.js 15 & 데이터 처리 규칙
### 서버/클라이언트 경계
- 비즈니스 로직, DB 접근, AI 호출은 반드시 서버(`'use server'`)에서 수행.
- 인터랙티브 요소만 `'use client'` 사용.

### 데이터 검증 (Zod)
- 모든 서버 액션은 실행 전 Zod 스키마를 통해 `formData` 또는 인자를 검증해야 함.
- 유효하지 않은 데이터는 즉시 한글 에러 메시지를 반환.

### 캐싱
- 데이터의 실시간성 여부에 따라 `revalidatePath` 또는 `revalidateTag`를 명시적으로 사용.

## 4. UI/UX 및 상호작용 (필수)
### 3대 상태 보장
모든 비동기 작업(데이터 페칭, 폼 제출)에 다음을 구현할 것.

- 로딩: Skeleton UI 또는 pending 상태 표시.
- 빈 상태: 데이터 없을 시 안내 문구 및 유도 버튼(CTA).
- 오류: 한글 에러 메시지 + 재시도 버튼.

### 낙관적 업데이트
- 할 일 체크 등 즉각적인 반응이 필요한 곳에 `useOptimistic` 적용 (실패 시 롤백 로직 필수).

### 중복 방지
- 폼 제출 시 버튼 `disabled` 처리 및 Loading 스피너 노출.

## 5. 코딩 스타일 및 문서화
- 함수형 컴포넌트: 모든 함수는 화살표 함수(`const Name = () => ...`) 사용.
- 네이밍: 파스칼 케이스(파일/컴포넌트), 불리언은 `is/has/can` 접두어.

### 한글 주석 필수
- 모든 컴포넌트, 커스텀 훅, 서버 액션 상단에 기능을 설명하는 한글 주석 작성.
- 코드 내 복잡한 로직은 JSDoc(한글) 활용.

## 6. Supabase 및 보안 규칙
- RLS 기반 설계: 모든 쿼리는 로그인된 사용자의 `user_id`를 기준으로 필터링.
- 권한 보호: 클라이언트에서 DB에 직접 쓰지 말 것. 반드시 서버 액션에서 유저 세션을 확인한 뒤 수행.
- 타입 매칭: Supabase 생성 타입을 우선 사용하고, 필요한 경우에만 `Omit` 등으로 확장.

## 7. AI SDK 연동 규칙
- 보안: API Key는 반드시 `.env.local`에 보관하며 서버 환경에서만 호출.

### AI 인터랙션
- `useChat` 또는 `streamText` 사용 시 `isLoading` 상태를 UI에 반드시 반영하여 사용자 이탈 방지.
- AI가 생성한 결과로 DB를 수정할 때는 반드시 사용자에게 확인(Confirm) 단계를 거칠 것.
- 데이터 최소화: 모델 전송 시 민감한 개인정보(비밀번호, 이메일 전체 등)는 마스킹하거나 제외.

## 8. 작업 체크리스트 (AI 자가 검토)
- [ ] 서버 컴포넌트와 클라이언트 컴포넌트의 경계가 명확한가?
- [ ] Zod로 입력값 검증을 수행했는가?
- [ ] 로딩/빈 상태/오류 UI가 한글로 구현되었는가?
- [ ] 모든 핵심 함수 상단에 한글 주석이 있는가?
- [ ] Supabase RLS 및 사용자 권한 확인 로직이 포함되었는가?
- [ ] `features/` 폴더 내에 관련 컴포넌트들이 잘 응집되어 있는가?

